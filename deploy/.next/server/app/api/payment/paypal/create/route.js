(()=>{var e={};e.id=581,e.ids=[581],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30496:()=>{},43648:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},54686:(e,t,r)=>{"use strict";r.d(t,{R:()=>o});var a=r(22057),n=r(15886);async function o(){let e=process.env.NEXT_PUBLIC_SUPABASE_URL,t=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;if(!e||!t)return console.warn("[Server Client] Supabase environment variables not found"),null;try{let r=await (0,n.UL)();return(0,a.createServerClient)(e,t,{cookies:{get:e=>r.get(e)?.value,set(e,t,a){try{r.set(e,t,a)}catch{}},remove(e,t){try{r.set(e,"",{...t,maxAge:0})}catch{}}}})}catch(e){return console.error("[Server Client] Error creating Supabase client:",e),null}}},55591:e=>{"use strict";e.exports=require("https")},62601:(e,t,r)=>{"use strict";r.r(t),r.d(t,{"00bcca68d0ce453cbb502af9c4a580bb98f16e2cb6":()=>a.jp,"4074b14fd84ce858a8f88c2aed0f8d3d44a5c9fe71":()=>a.kd,"409537380482c972f20e534a5154edc7d6dcdc90e8":()=>a.cq,"40d987bfc04886ab4691d0cae59301a4d5644ff503":()=>a.ed,"609623c9b9d2de4e11ffc1f44181551fb8dd229eb3":()=>a.Yq,"702417240f52255b4157c05a03908f5dedb19d18c2":()=>a.IO});var a=r(70109)},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},70109:(e,t,r)=>{"use strict";r.d(t,{IO:()=>d,Yq:()=>c,cq:()=>u,ed:()=>i,jp:()=>s,kd:()=>p});var a=r(80643);r(28629);var n=r(54686),o=r(15886);async function s(){let e=(0,n.R)();if(!e)return{paypal:null,crypto:null};try{let{data:t}=await e.from("admin_settings").select("*");if(!t)return{paypal:null,crypto:null};let r=t.reduce((e,t)=>(e[t.setting_key]=t.setting_value,e),{}),a=r.paypal_client_id?{clientId:r.paypal_client_id,clientSecret:r.paypal_client_secret||"",environment:"sandbox"}:null,n=r.blockcypher_api_key?{apiKey:r.blockcypher_api_key,btcAddress:r.btc_wallet_address||"",ltcAddress:r.ltc_wallet_address||"",ethAddress:r.eth_wallet_address||""}:null;return{paypal:a,crypto:n}}catch(e){return console.error("Failed to get payment config:",e),{paypal:null,crypto:null}}}async function c(e,t=1){let r=(0,n.R)();if(!r)throw Error("Database connection failed");let{paypal:a}=await s();if(!a)throw Error("PayPal not configured");try{let n=await fetch("https://api-m.sandbox.paypal.com/v1/oauth2/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${Buffer.from(`${a.clientId}:${a.clientSecret}`).toString("base64")}`},body:"grant_type=client_credentials"}),s=(await n.json()).access_token,c=function(){if(process.env.NEXT_PUBLIC_SITE_URL)return process.env.NEXT_PUBLIC_SITE_URL;if(process.env.VERCEL_URL)return`https://${process.env.VERCEL_URL}`;try{let e=(0,o.b3)(),t=e.get("host"),r=e.get("x-forwarded-proto")||"http";if(t)return`${r}://${t}`}catch(e){console.warn("Could not get site URL from headers:",e)}return"http://localhost:3000"}(),i=await fetch("https://api-m.sandbox.paypal.com/v2/checkout/orders",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({intent:"CAPTURE",purchase_units:[{amount:{currency_code:"USD",value:t.toFixed(2)},description:"YukiFiles Premium Subscription - 1 Month"}],application_context:{return_url:`${c}/payment/success`,cancel_url:`${c}/payment/cancel`}})}),d=await i.json();if(d.id)return await r.from("transactions").insert({user_id:e,payment_method:"paypal",payment_id:d.id,amount:t,currency:"USD",status:"pending"}),{orderId:d.id,approvalUrl:d.links.find(e=>"approve"===e.rel)?.href};throw Error("Failed to create PayPal order")}catch(e){throw console.error("PayPal order creation error:",e),e}}async function i(e){let t=(0,n.R)();if(!t)throw Error("Database connection failed");let{paypal:r}=await s();if(!r)throw Error("PayPal not configured");try{let a=await fetch("https://api-m.sandbox.paypal.com/v1/oauth2/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${Buffer.from(`${r.clientId}:${r.clientSecret}`).toString("base64")}`},body:"grant_type=client_credentials"}),n=(await a.json()).access_token,o=await fetch(`https://api-m.sandbox.paypal.com/v2/checkout/orders/${e}/capture`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}}),s=await o.json();if("COMPLETED"===s.status){let{data:r}=await t.from("transactions").update({status:"completed",completed_at:new Date().toISOString(),metadata:s}).eq("payment_id",e).select("user_id").single();return r&&await u(r.user_id),{success:!0,captureId:s.id}}throw Error("Payment capture failed")}catch(e){throw console.error("PayPal capture error:",e),e}}async function d(e,t,r=1){let a=(0,n.R)();if(!a)throw Error("Database connection failed");let{crypto:o}=await s();if(!o)throw Error("Crypto payments not configured");try{let n=await l(t,r),s=function(e,t){switch(e){case"BTC":return t.btcAddress;case"LTC":return t.ltcAddress;case"ETH":return t.ethAddress;default:return""}}(t,o);if(!s)throw Error(`${t} wallet not configured`);let{data:c}=await a.from("transactions").insert({user_id:e,payment_method:"crypto",amount:r,currency:"USD",crypto_currency:t,crypto_address:s,status:"pending",metadata:{crypto_amount:n,wallet_address:s}}).select().single();return{transactionId:c.id,walletAddress:s,cryptoAmount:n,currency:t}}catch(e){throw console.error("Crypto payment creation error:",e),e}}async function l(e,t){return Number((t/(({BTC:45e3,LTC:100,ETH:2500})[e]||1)).toFixed(8))}async function u(e){let t=(0,n.R)();if(!t)throw Error("Database connection failed");try{let r=new Date;return r.setMonth(r.getMonth()+1),await t.from("users").update({subscription_type:"paid",subscription_expires_at:r.toISOString(),quota_limit:0x140000000}).eq("id",e),console.log(`[v0] User ${e} upgraded to premium`),{success:!0}}catch(e){throw console.error("Failed to upgrade user:",e),e}}async function p(e){let t=(0,n.R)();if(!t)throw Error("Database connection failed");try{let{data:r}=await t.from("transactions").select("*").eq("id",e).single();if(!r)throw Error("Transaction not found");if(Math.random()>.5)return await t.from("transactions").update({status:"completed",completed_at:new Date().toISOString()}).eq("id",e),await u(r.user_id),{confirmed:!0};return{confirmed:!1}}catch(e){throw console.error("Crypto payment check error:",e),e}}(0,r(27873).D)([s,c,i,d,u,p]),(0,a.A)(s,"00bcca68d0ce453cbb502af9c4a580bb98f16e2cb6",null),(0,a.A)(c,"609623c9b9d2de4e11ffc1f44181551fb8dd229eb3",null),(0,a.A)(i,"40d987bfc04886ab4691d0cae59301a4d5644ff503",null),(0,a.A)(d,"702417240f52255b4157c05a03908f5dedb19d18c2",null),(0,a.A)(u,"409537380482c972f20e534a5154edc7d6dcdc90e8",null),(0,a.A)(p,"4074b14fd84ce858a8f88c2aed0f8d3d44a5c9fe71",null)},74075:e=>{"use strict";e.exports=require("zlib")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91713:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>h,routeModule:()=>u,serverHooks:()=>y,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>f});var a={};r.r(a),r.d(a,{POST:()=>l});var n=r(36044),o=r(63409),s=r(9576),c=r(10949),i=r(54686),d=r(70109);async function l(e){try{let t=(0,i.R)();if(!t)return c.NextResponse.json({error:"Database connection failed"},{status:500});let{data:{user:r}}=await t.auth.getUser();if(!r)return c.NextResponse.json({error:"Authentication required"},{status:401});let{userId:a,amount:n}=await e.json(),{data:o}=await t.from("users").select("*").eq("id",a).eq("email",r.email).single();if(!o)return c.NextResponse.json({error:"User not found"},{status:404});let s=await (0,d.Yq)(a,n);return c.NextResponse.json(s)}catch(e){return console.error("PayPal create error:",e),c.NextResponse.json({error:"Failed to create payment"},{status:500})}}let u=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/payment/paypal/create/route",pathname:"/api/payment/paypal/create",filename:"route",bundlePath:"app/api/payment/paypal/create/route"},resolvedPagePath:"/workspace/app/api/payment/paypal/create/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:p,workUnitAsyncStorage:f,serverHooks:y}=u;function h(){return(0,s.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:f})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[9369,6550,5392,2920,3055],()=>r(91713));module.exports=a})();